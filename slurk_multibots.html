

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Pairing up participants and running multiple rooms &mdash; slurk 2.0.0-pre documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Layouts and Plugins" href="slurk_layouts.html" />
    <link rel="prev" title="2. Getting Started" href="slurk_gettingstarted.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> slurk
          

          
          </a>

          
            
            
              <div class="version">
                2.0.0-pre
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="slurk_about.html">1. Slurk: What’s this?</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_gettingstarted.html">2. Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Pairing up participants and running multiple rooms</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_layouts.html">4. Layouts and Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_bots.html">5. Writing your own bots</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_api.html">6. REST API for slurk</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_deployment.html">7. Deployment of the system</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_amt.html">8. Getting participants from Amazon Mechanical Turk</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">slurk</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>3. Pairing up participants and running multiple rooms</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/slurk_multibots.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pairing-up-participants-and-running-multiple-rooms">
<span id="slurk-multibots"></span><h1>3. Pairing up participants and running multiple rooms<a class="headerlink" href="#pairing-up-participants-and-running-multiple-rooms" title="Permalink to this headline">¶</a></h1>
<p>In the following steps you will learn how to let bots and human users enter the slurk waiting room where users will be
paired up and put into a new task-specific chatroom along with bots. We provided an example bot handling this mechanism:
The <strong>concierge bot</strong> moves human users and other bots from the waiting room to a taskroom.</p>
<p>First of all, we need a waiting room and a task. For the waiting room, we submit the layout. Let’s take the layout
provided in the <em>sample_bots</em> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl https://raw.githubusercontent.com/clp-research/slurk/master/sample_bots/concierge/layout.json &gt; waiting_room_layout.json
</pre></div>
</div>
<p>This layout now has to be pushed to the server. For this command you may have to install <code class="docutils literal notranslate"><span class="pre">jq</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install jq
$ WAITING_ROOM_LAYOUT=$(curl -X POST \
       -H &quot;Authorization: Token $ADMIN_TOKEN&quot; \
       -H &quot;Content-Type: application/json&quot; \
       -H &quot;Accept: application/json&quot; \
       -d @waiting_room_layout.json \
       localhost/api/v2/layout | jq .id)
</pre></div>
</div>
<p>Ensure we have a valid id:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo $WAITING_ROOM_LAYOUT
2
</pre></div>
</div>
<p>We can now create the waiting room with the associated layout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -X POST \
       -H &quot;Authorization: Token $ADMIN_TOKEN&quot; \
       -H &quot;Content-Type: application/json&quot; \
       -H &quot;Accept: application/json&quot; \
       -d &quot;{\&quot;name\&quot;: \&quot;waiting_room\&quot;, \&quot;label\&quot;: \&quot;Waiting Room\&quot;, \&quot;layout\&quot;: $WAITING_ROOM_LAYOUT}&quot; \
       localhost/api/v2/room
{
  &quot;current_users&quot;: {},
  &quot;label&quot;: &quot;Waiting Room&quot;,
  &quot;layout&quot;: null,
  &quot;name&quot;: &quot;waiting_room&quot;,
  &quot;read_only&quot;: false,
  &quot;show_latency&quot;: true,
  &quot;show_users&quot;: true,
  &quot;static&quot;: false,
  &quot;users&quot;: {}
}
</pre></div>
</div>
<p>The next step is to create a task. Each task contains information about the number of user required in order to start
the task:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ TASK_ID=$(curl -X POST \
       -H &quot;Authorization: Token $ADMIN_TOKEN&quot; \
       -H &quot;Content-Type: application/json&quot; \
       -H &quot;Accept: application/json&quot; \
       -d &#39;{&quot;name&quot;: &quot;Echo Task&quot;, &quot;num_users&quot;: 2}&#39; \
       localhost/api/v2/task | jq .id)
</pre></div>
</div>
<p>The token for the bot is stored in <code class="docutils literal notranslate"><span class="pre">CONCIERGE_BOT_TOKEN</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ CONCIERGE_BOT_TOKEN=$(curl -X POST \
       -H &quot;Authorization: Token $ADMIN_TOKEN&quot; \
       -H &quot;Content-Type: application/json&quot; \
       -H &quot;Accept: application/json&quot; \
       -d &#39;{&quot;room&quot;: &quot;waiting_room&quot;, &quot;message_text&quot;: true, &quot;room_create&quot;: true, &quot;user_room_join&quot;: true}&#39; \
       localhost/api/v2/token | sed &#39;s/^&quot;\(.*\)&quot;$/\1/&#39;)
</pre></div>
</div>
<p>Now start the concierge bot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker run -e TOKEN=$CONCIERGE_BOT_TOKEN --net=&quot;host&quot; slurk/concierge-bot
</pre></div>
</div>
<p>The concierge bot is joining the waiting room now. It waits for two users to join the waiting room, which has both the
specified task assigned. Once, both has joined, the bot will create a new task room and moves both users into that room.
We want the echo-bot to join this task room as well. The concierge bot emits two events, when creating a new task room:
<code class="docutils literal notranslate"><span class="pre">new_room</span></code> and <code class="docutils literal notranslate"><span class="pre">new_task_room</span></code>. The echo bot is able to listen to those events. So let’s create a token for this
bot, too:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ECHO_BOT_TOKEN=$(curl -X POST \
       -H &quot;Authorization: Token $ADMIN_TOKEN&quot; \
       -H &quot;Content-Type: application/json&quot; \
       -H &quot;Accept: application/json&quot; \
       -d &#39;{&quot;room&quot;: &quot;waiting_room&quot;, &quot;message_text&quot;: true, &quot;user_room_join&quot;: true}&#39; \
       localhost/api/v2/token | sed &#39;s/^&quot;\(.*\)&quot;$/\1/&#39;)
</pre></div>
</div>
<p>This bot has an optional <code class="docutils literal notranslate"><span class="pre">task-id</span></code> parameter, to listen to specific tasks to join. Let’s start it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker run -e TOKEN=$ECHO_BOT_TOKEN -e ECHO_TASK_ID=$TASK_ID --net=&quot;host&quot; slurk/echo-bot
</pre></div>
</div>
<p>Now lets create two user tokens and specify the task:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -X POST \
       -H &quot;Authorization: Token $ADMIN_TOKEN&quot; \
       -H &quot;Content-Type: application/json&quot; \
       -H &quot;Accept: application/json&quot; \
       -d &quot;{\&quot;room\&quot;: \&quot;waiting_room\&quot;, \&quot;message_text\&quot;: true, \&quot;task\&quot;: $TASK_ID}&quot; \
       localhost/api/v2/token | sed &#39;s/^&quot;\(.*\)&quot;$/\1/&#39;
</pre></div>
</div>
<p>Open two browsers or two private tabs, log in with two different tokens and wait for the concierge bot to move both
users to a new room. The echo bot will also join this room and replies to every chat message.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="slurk_layouts.html" class="btn btn-neutral float-right" title="4. Layouts and Plugins" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="slurk_gettingstarted.html" class="btn btn-neutral float-left" title="2. Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018 DSG Bielefeld, 2019 CL Potsdam

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>